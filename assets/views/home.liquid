{%- if channel -%}
  {%- assign bodyClasses = 'channel-ready' -%}
{%- else -%}
  {%- assign hideAppbar = true -%}
{%- endif -%}

{% layout 'layout/default' %}

{% block appbar %}
<ul class="navbar-nav ml-auto">
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      {{channel.name}}
    </a>
    <div class="dropdown-menu dropdown-menu-right dropdown-menu-dark" aria-labelledby="navbarDropdown">
      <a class="dropdown-item" href="#" id="channel-change-password">Change Password</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item" href="#" id="channel-leave">Leave</a>
    </div>
  </li>
</ul>
{% endblock %}

{% block content %}
  <div class="container-fluid">
    {% if channel %}
      <div class="filter-panel mb-3">
        <div class="filter-group">
          <div class="btn-group btn-group-toggle" data-toggle="buttons">
          {% for quality in gameData.itemQualities %}
            <label class="btn btn-sm btn-quality btn-quality-{{ quality }} active" data-tippy-content="Toggle {{ quality }}">
              <input type="checkbox" name="quality-{{ quality }}" id="btn-quality-{{ quality }}" autocomplete="off" checked />
              <span class="label-active font-serif">âœ“</span>
              <span class="label-inactive font-serif">&nbsp;</span>
            </label>
            {% endfor %}
          </div>
          <div class="filter-group form-inline">
            <input type="date" class="form-control form-control-sm" placeholder="Date" data-tippy-content="Date" />
          </div>
        </div>
      </div>
      <div class="item-list" id="items"></div>
    {% else %}
      <form class="form-channel" id="entry-channel-form">
        <h4 class="heading">Join/Register a Channel</h4>
        <div class="alert" role="alert" id="alert"></div>
        <div class="form-group">
          <label for="channel-name">Name</label>
          <input type="text" required class="form-control" autofocus placeholder="Channel Name" aria-label="Channel Name" id="channel-name" />
        </div>
        <div class="form-group">
          <label for="channel-password">Password</label>
          <input type="text" required class="form-control" placeholder="Channel Password" aria-label="Channel Password" id="channel-password" />
        </div>
        <div class="form-group d-flex justify-content-between">
          <button type="button" class="btn btn-secondary" id="channel-register">Register</button>
          <button type="submit" class="btn btn-primary" id="channel-join">Join &rarr;</button>
        </div>
      </form>
    {% endif %}
  </div>
  {% raw %}
  <script id="template_item" type="text/liquid">
    <div class="item {{ name | deco_hr_class }}" data-id="{{ _id }}" data-quality="{{ quality }}" data-action="{{ action }}">
      <div class="item-base">
        <div class="title">
          <span class="color-{{ quality }}">{{ name | deco_rune }}</span>
          <span class="fz-14 color-gray">({{ level }})</span>
        </div>
        <div class="time color-gray fz-14">
          <b>{{ action }}</b> {{ timestamp | date: '%H:%M' }}
        </div>
      </div>
    </div>
  </script>
  <script id="template_item_detail" type="text/liquid">
    <div class="item-detail {{ name | deco_hr_class }}">
      <div class="title font-d2">
        <span class="color-{{ quality }}">{{ name | deco_rune }}</span>
        <span class="fz-14 color-gray">({{ level }})</span>
      </div>
      <div class="body">
        <ul class="stats">
          {% for mod in stats %}
            <li class="font-d2">
              {{ mod | mod_color: isRune }}
            </li>
          {% endfor %}
          <li class="st info">
            <b>{{ action }}:</b><span>{{ timestamp | date: '%Y-%m-%d %H:%M' }}</span>
          </li>
          <li class="info">
            <b>Profile:</b><span>{{ profile }}</span>
          </li>
          <li class="info">
            <b>Area:</b><span>{{ area }}{% if isRecipe %} (Cubing){% endif %}</span>
          </li>
        </ul>
      </div>
    </div>
  </script>
  {% endraw %}
  <script src="/socket.io/socket.io.js"></script>
  <script src="/js/app.js"></script>
{% endblock %}
